# 抽奖签到插件 for AstrBot

一个功能丰富的抽奖签到插件，支持多群组独立数据库配置。

## 功能特点

- ✅ 每日签到获得抽奖机会  
- 🎰 抽奖系统：随机获得积分、元宝、游戏道具  
- 🏆 连续签到奖励：额外抽奖机会  
- 🎯 多群组独立数据库配置  
- 📊 丰富的查询功能  
- 🔧 管理员管理工具  

## 安装说明

### 1. 安装依赖
确保已安装 `pyodbc` 库：
```bash
pip install pyodbc
```

### 2. 安装插件
1. 将 `astrbot_plugin_draw_checkin.py` 放入 AstrBot 的 `plugins` 目录  
2. 将 `_conf_schema.json` 放入同一目录  
3. 重启 AstrBot

### 3. 配置数据库

#### 方法一：通过WebUI配置默认数据库（适合单群或测试）
在 AstrBot 的 WebUI 中配置默认数据库信息（注意：不要填写真实密码，仅用于占位）

#### 方法二：为每个QQ群配置独立数据库（强烈推荐）
群管理员在群内使用以下命令配置：

```
/设置群数据库 [服务器] [端口] [数据库名] [用户名] [密码]
```

示例：
```
/设置群数据库 192.168.1.100 1433 MuOnline sa password123
```

## 用户命令

| 命令               | 说明                     | 示例               |
|-------------------|--------------------------|--------------------|
| /签到             | 每日签到获得抽奖机会      | /签到             |
| /抽奖 [次数]      | 使用抽奖机会（不填默认1次）| /抽奖 3           |
| /抽奖机会         | 查看剩余抽奖机会          | /抽奖机会         |
| /抽奖历史         | 查看最近抽奖记录          | /抽奖历史         |
| /我的道具         | 查看待兑换的游戏道具      | /我的道具         |
| /绑定游戏账号 [账号] | 绑定游戏账号            | /绑定游戏账号 myaccount |
| /我的绑定         | 查看已绑定的游戏账号      | /我的绑定         |
| /签到查询         | 查看签到天数、连续天数等  | /签到查询         |
| /解绑游戏账号     | 解绑已绑定的游戏账号      | /解绑游戏账号     |
| /签到重置         | 重置自己的签到数据        | /签到重置         |

## 管理员命令

| 命令                 | 说明                        | 示例                            |
|----------------------|-----------------------------|---------------------------------|
| /设置群数据库        | 配置本群独立数据库          | /设置群数据库 127.0.0.1 1433 MU sa 123 |
| /群数据库状态        | 查看当前群数据库配置状态    | /群数据库状态                  |
| /删除群数据库配置    | 删除本群独立数据库配置      | /删除群数据库配置              |
| /管理员重置 @用户    | 重置指定用户的所有数据      | /管理员重置 @某人               |

## 抽奖配置

抽奖物品配置文件位于：  
`data/plugin-data/astrbot_plugin_draw_checkin/lottery_items.json`

你可以自由修改：
- 奖品类型和概率
- 奖品数量范围（最小~最大）
- 特殊奖励效果（如全服公告、保底机制等）

## 数据存储位置

- 签到数据：`data/plugin-data/astrbot_plugin_draw_checkin/checkin_data.json`
- 账号绑定数据：`data/plugin-data/astrbot_plugin_draw_checkin/account_bind.json`
- 群组数据库配置：`data/plugin-data/astrbot_plugin_draw_checkin/group_configs.json`
- 抽奖物品配置：`data/plugin-data/astrbot_plugin_draw_checkin/lottery_items.json`

## 安全提示

⚠️ 重要安全提醒：
- 默认配置不包含任何真实数据库信息
- 强烈建议为每个群组配置独立的只读/专用数据库账号
- 数据库密码请妥善保管，切勿泄露
- 定期备份插件数据目录

## 支持与反馈

如有问题或建议，请在 GitHub 仓库提交 Issue：  
https://github.com/MUxiaokalami/mudaka

## 许可证

MIT License
